import{r as m,j as e,u as R,H as E}from"./app-Cz7Ofm5u.js";import{W as M}from"./WebsiteStatsChart-BAQaUK0M.js";import{A as K}from"./app-layout-D664Sm0m.js";/* empty css            */import"./PieChart-CneJuAKV.js";import"./index-CjeX7Bxr.js";import"./clsx-B-dksMZM.js";import"./index-B4Ly7SNM.js";import"./index-DoHETrAt.js";import"./button-DfXnVGyv.js";import"./index-BMGb6Dol.js";import"./app-logo-icon-BuQHClkQ.js";const W=s=>{try{return new Date(s).toLocaleString("en-PK",{timeZone:"Asia/Karachi",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(r){return console.error("Error formatting datetime:",r),s}},T=s=>{try{return new Date(s).toLocaleString("en-US",{timeZone:"Asia/Karachi",month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(r){return console.error("Error formatting datetime:",r),s}};function I({history:s,websiteId:r,apiEndpoint:g="/websites"}){const[i,p]=m.useState(s),[d,f]=m.useState(!1),[y,b]=m.useState(!1),[k,j]=m.useState(null),[x,H]=m.useState({status:"all",dateRange:"all"}),[l,w]=m.useState(null),[N,v]=m.useState(!1),u=t=>t.status?t.status.toLowerCase():t.is_up?"up":"down",_=t=>{switch(u(t)){case"up":return"bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-200";case"down":return"bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-200";case"timeout":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-200";case"error":return"bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}},A=(t,c,a)=>{const o=new Date,n={};switch(t){case"24h":n.from=new Date(o.getTime()-1440*60*1e3).toISOString();break;case"7d":n.from=new Date(o.getTime()-10080*60*1e3).toISOString();break;case"30d":n.from=new Date(o.getTime()-720*60*60*1e3).toISOString();break;case"custom":c&&(n.from=c),a&&(n.to=a);break}return n},S=async(t=0,c=!0)=>{b(!0),j(null);try{const a=new URLSearchParams;a.append("limit","50"),a.append("offset",t.toString()),x.status!=="all"&&a.append("status",x.status);const o=A(x.dateRange,x.customFrom,x.customTo);o.from&&a.append("from",o.from),o.to&&a.append("to",o.to);const n=await fetch(`${g}/${r}/history?${a}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const h=await n.json();p(c?h.data:P=>[...P,...h.data]),w(h.meta),v(h.meta.has_more)}catch(a){j(a instanceof Error?a.message:"Failed to fetch history")}finally{b(!1)}},D=()=>{f(!0),S(0,!0)},L=()=>{l&&N&&S(l.offset+l.limit,!1)},C=()=>{f(!1),p(s),H({status:"all",dateRange:"all"}),w(null),v(!1)},$=l?l.uptime_percentage:Math.round(i.filter(t=>u(t)==="up").length/i.length*100);return e.jsxs("div",{className:"rounded-lg bg-white p-4 shadow dark:bg-gray-900",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:d?"All History":"Recent Checks"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Times shown in Pakistan Time (PKT)"}),!d&&e.jsx("button",{onClick:D,className:"text-sm font-medium text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",children:"View All History"}),d&&e.jsx("button",{onClick:C,className:"text-sm font-medium text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Show Recent Only"})]})]}),k&&e.jsx("div",{className:"mb-4 rounded-md border border-red-200 bg-red-50 p-3 dark:border-red-700 dark:bg-red-900/20",children:e.jsx("p",{className:"text-sm text-red-700 dark:text-red-400",children:k})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-300",children:"Checked At"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-300",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-300",children:"Response Time"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900",children:i.map((t,c)=>e.jsxs("tr",{className:"transition-colors duration-150 hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:T(t.checked_at)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:W(t.checked_at)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize ${_(t)}`,children:[e.jsx("span",{className:`mr-1.5 h-2 w-2 rounded-full ${u(t)==="up"?"bg-green-400":"bg-red-400"}`}),u(t)]})})}),e.jsx("td",{className:"px-6 py-4 text-sm whitespace-nowrap text-gray-900 dark:text-gray-100",children:t.response_time?e.jsxs("span",{className:`font-mono ${t.response_time<500?"text-green-600 dark:text-green-400":t.response_time<1e3?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:[t.response_time,"ms"]}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"N/A"})})]},t.id||c))})]}),y&&e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-b-2 border-gray-900 dark:border-gray-100"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Loading history..."})]}),d&&N&&!y&&e.jsx("div",{className:"py-4 text-center",children:e.jsx("button",{onClick:L,className:"rounded-md border border-blue-300 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 hover:text-blue-800 dark:border-blue-600 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:hover:text-blue-200",children:"Load More"})}),i.length===0&&!y&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-12 w-12",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100",children:d?"No results found":"No check history"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:d?"Try adjusting your filters.":"Check history will appear here once monitoring begins."})]})]}),i.length>0&&e.jsxs("div",{className:"mt-4 flex items-center justify-between border-t border-gray-200 pt-4 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:d&&l?`${l.filtered_total} total checks`:`${i.length} recent checks`}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Uptime: ",$,"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Last updated: ",i.length>0?T(i[0].checked_at):"Never"]})]})]})}function Y(){const{props:s}=R(),{website:r,stats:g,history:i}=s;return e.jsxs(K,{breadcrumbs:[{title:"Dashboard",href:"/websites"},{title:r.name,href:`/websites/${r.id}`}],children:[e.jsx(E,{title:r.name}),e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsx(M,{data:g.hourly_data,uptimePercentage:g.uptime_percentage}),e.jsx(I,{websiteId:r.id,history:i.data})]})]})}export{Y as default};
